/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

define(["underscore","core/rave_ajax","core/rave_state_manager","core/rave_event_manager"],function(e,t,n,r){function s(e,t,n){alert(n)}var i="";r.registerOnInitHandler(function(){i=n.getContext()});var o=function(){function n(n){var r={preferences:[]};for(var o in n.userPrefs)r.preferences.push({name:o,value:n.userPrefs[o]});t({type:"PUT",url:i+e+"regionWidgets/"+n.regionWidgetId+"/preferences",data:JSON.stringify(r),contentType:"application/json",dataType:"json",success:function(e){typeof n.successCallback=="function"&&n.successCallback()},error:s})}function r(n){t({type:"PUT",url:i+e+"regionWidgets/"+n.regionWidgetId+"/preferences/"+n.prefName,data:JSON.stringify({name:n.prefName,value:n.prefValue}),contentType:"application/json",dataType:"json",success:function(e){typeof n.successCallback=="function"&&n.successCallback()},error:s})}function o(n){t({type:"PUT",url:i+e+"regionWidgets/"+n.regionWidgetId+"/collapsed",data:JSON.stringify(n.collapsed),contentType:"application/json",dataType:"json",success:n.successCallback,error:s})}function u(n){t({type:"DELETE",url:i+e+"page/"+n.pageId,success:function(e){typeof n.successCallback=="function"&&n.successCallback()},error:s})}function a(n){t({type:"DELETE",url:i+e+"widgets/"+n.widgetId+"/rating",success:function(e){typeof n.successCallback=="function"&&n.successCallback()},error:s})}function f(n){t({type:"POST",url:i+e+"widgets/"+n.widgetId+"/rating?score="+n.score,success:function(e){typeof n.successCallback=="function"&&n.successCallback()},error:s})}function l(n){t({type:"POST",url:i+e+"widgets/"+n.widgetId+"/comments?text="+escape(n.text),success:function(e){typeof n.successCallback=="function"&&n.successCallback()},error:s})}function c(n){t({type:"DELETE",url:i+e+"widgets/"+n.widgetId+"/comments/"+n.commentId,success:function(e){typeof n.successCallback=="function"&&n.successCallback()},error:s})}function h(n){t({type:"POST",url:i+e+"widgets/"+n.widgetId+"/comments/"+n.commentId+"?text="+escape(n.text),success:function(e){typeof n.successCallback=="function"&&n.successCallback()},error:s})}function p(n){t({type:"GET",url:i+e+"widgets/"+n.widgetId+"/users",success:function(e){typeof n.successCallback=="function"&&n.successCallback(e)},error:s})}function d(n){t({type:"POST",url:i+e+"widgets/"+n.widgetId+"/tags?tagText="+escape(n.text),success:function(e){typeof n.successCallback=="function"&&n.successCallback()},error:s})}function v(n){t({type:"GET",url:i+e+"widgets/"+n.widgetId+"/tags",dataType:"json",success:function(e){typeof n.successCallback=="function"&&n.successCallback(e)}})}function m(e){t({type:"GET",url:i+"api/rest/opensocial/gadget?url="+e.url+"&pageid="+e.pageid,dataType:"json",success:function(t){typeof e.successCallback=="function"&&e.successCallback(t)}})}var e="api/rest/";return{updateWidgetRating:f,deleteWidgetRating:a,saveWidgetPreferences:n,saveWidgetPreference:r,saveWidgetCollapsedState:o,createWidgetComment:l,updateWidgetComment:h,deleteWidgetComment:c,deletePage:u,getUsersForWidget:p,createWidgetTag:d,getTags:v,getSecurityToken:m}}(),u=function(){function r(e){t({type:"POST",url:i+n+"page/regionWidget/"+e.regionWidgetId+"/move",data:{newPosition:e.toIndex,toRegion:e.toRegionId,fromRegion:e.fromRegionId},dataType:"json",success:function(e){e.error&&d(e)},error:s})}function o(e){t({type:"POST",url:i+n+"page/"+e.pageId+"/widget/add",data:{widgetId:e.widgetId},dataType:"json",success:function(t){if(t.error)d(t);else{var n=t.result!=undefined?t.result.widgetId:undefined;e.successCallback&&n!=undefined&&e.successCallback(t.result)}},error:s})}function u(r){t({type:"POST",url:i+n+"page/regionWidget/"+r.regionWidgetId+"/delete",data:null,dataType:"json",success:function(t){t.error?d(t):e.isFunction(r.successCallback)&&r.successCallback()},error:s})}function a(e){t({type:"POST",url:i+n+"page/add",data:{pageName:e.pageName,pageLayoutCode:e.pageLayoutCode},dataType:"json",success:function(t){t.error?t.errorCode=="DUPLICATE_ITEM"?typeof e.errorCallback=="function"&&e.errorCallback(e.errorLabel):d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function f(e){t({type:"GET",url:i+n+"page/get",data:{pageId:e.pageId},dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function l(e){var r={};e.moveAfterPageId&&(r.moveAfterPageId=e.moveAfterPageId),t({type:"POST",url:i+n+"page/"+e.pageId+"/move",data:r,dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function c(e){var r={};e.toPageId&&(r.toPageId=e.toPageId,r.regionWidgetId=e.regionWidgetId),t({type:"POST",url:i+n+"page/"+e.toPageId+"/moveWidget",data:r,dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function h(e){t({type:"POST",url:i+n+"page/"+e.pageId+"/update",data:{name:e.title,layout:e.layout},dataType:"json",success:function(t){t.error?t.errorCode=="DUPLICATE_ITEM"?typeof e.errorCallback=="function"&&e.errorCallback(e.errorLabel):d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function p(e){t({type:"GET",url:i+n+"page/get?pageId="+e.pageId,dataType:"json",success:function(t){typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function d(e){switch(e.errorCode){case"NO_ERROR":break;case"INVALID_PARAMS":alert(e);break;case"INTERNAL_ERROR":alert(e)}}function v(e){var r=e.url,o=e.providerType;if((r==null||o==null)&&typeof e.alertInvalidParams=="function"){e.alertInvalidParams();return}t({type:"POST",url:i+n+"widget/metadata/get",data:{url:r,type:o},dataType:"json",success:function(t){t.error&&typeof e.errorCallback=="function"?e.errorCallback():typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function m(e){var r=e.url,o=e.providerType;if((r==null||o==null)&&typeof e.alertInvalidParams=="function"){e.alertInvalidParams();return}t({type:"POST",url:i+n+"widget/metadatagroup/get",data:{url:r,type:o},dataType:"json",success:function(t){t.error&&typeof e.errorCallback=="function"?e.errorCallback():typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function g(e){t({type:"GET",url:i+n+"widget/getall",dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function y(e){var r=e.offset;t({type:"GET",url:i+n+"person/get",data:{offset:r},dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function b(e){var r=e.searchTerm,o=e.offset;if((r==null||r=="")&&typeof e.alertEmptySearch=="function"){e.alertEmptySearch();return}t({type:"GET",url:i+n+"person/search",data:{searchTerm:r,offset:o},dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function w(e){t({type:"POST",url:i+n+"page/"+e.pageId+"/clone",data:{userId:e.userId,pageName:e.pageName},dataType:"json",success:function(t){typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function E(e){t({type:"POST",url:i+n+"page/"+e.pageId+"/addmember",data:{userId:e.userId},dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function S(e){t({type:"POST",url:i+n+"page/"+e.pageId+"/removemember",data:{userId:e.userId},dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function x(e){t({type:"POST",url:i+n+"page/"+e.pageId+"/sharestatus",data:{shareStatus:e.shareStatus},dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function T(e){t({type:"POST",url:i+n+"page/"+e.pageId+"/editstatus",data:{userId:e.userId,isEditor:e.isEditor},dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function N(e){var r=encodeURIComponent(encodeURIComponent(e.friendUsername));t({type:"POST",url:i+n+"person/"+r+"/addfriend",data:null,dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function C(e){var r=encodeURIComponent(encodeURIComponent(e.friendUsername));t({type:"POST",url:i+n+"person/"+r+"/removefriend",data:null,dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function k(e){t({type:"POST",url:i+n+"person/getFriends",data:null,dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function L(e){var r=encodeURIComponent(encodeURIComponent(e.friendUsername));t({type:"POST",url:i+n+"person/"+r+"/acceptfriendrequest",data:null,dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}function A(e){t({type:"POST",url:i+n+"marketplace/add",data:{url:e.url,providerType:e.providerType},dataType:"json",success:function(t){t.error?d(t):typeof e.successCallback=="function"&&e.successCallback(t)},error:s})}var n="api/rpc/";return{moveWidgetToRegion:r,addWidgetToPage:o,removeWidget:u,addPage:a,getPage:f,updatePagePrefs:h,getPagePrefs:p,movePage:l,moveWidgetToPage:c,getWidgetMetadata:v,getWidgetMetadataGroup:m,getUsers:y,searchUsers:b,clonePageForUser:w,addMemberToPage:E,removeMemberFromPage:S,updateSharedPageStatus:x,updatePageEditingStatus:T,addFriend:N,removeFriend:C,getFriends:k,acceptFriendRequest:L,addWidgetFromMarketplace:A,getAllWidgets:g}}(),a={rest:o,rpc:u};return a});